<!DOCTYPE html>
<html>
<head>
<title>W3.CSS Template</title>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
.w3-sidebar a {font-family: "Roboto", sans-serif}
body,h1,h2,h3,h4,h5,h6,.w3-wide {font-family: "Montserrat", sans-serif;}
</style>

<!-- ‚úÖ GOOGLE GPT -->
<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
window.googletag = window.googletag || { cmd: [] };
</script>

<!-- ‚úÖ ONETRUST -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"
  type="text/javascript"
  charset="UTF-8"
  data-domain-script="0195138c-cdc8-738c-907d-131dad8db9ba-test">
</script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>

<!-- ‚úÖ ‚úÖ ‚úÖ ANALYTICS.JS (NOW LOADING CORRECTLY) -->
<script type="text/javascript"
  src="https://web-analytics-js2-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com/static/testing.js
  ?crossdomainflag=true
  &deleteprofile=true
  &multiDomainFlag=true
  &googleCookieSyncFlag=true
  &automaticTracking=true
  &domainArray=[%22example.com%22,%22vercel.app%22,%22anotherdomain.com%22]
  &requiredPurposeIds=[%221%22,%223%22,%224%22]
  &dataLayer=dataLayer">
</script>

<!-- ‚úÖ ADOBE LAUNCH -->
<script src="https://assets.adobedtm.com/e72b4113c11a/dea835227b36/launch-5cc6da518e0d-development.min.js" async></script>

<!-- ‚úÖ DATALAYER -->
<script>
window.dataLayer=window.dataLayer || [];
dataLayer.push({
  pageEnvironment : 'testPageEnvironment',
  pageContentType: 'pageContentType',
  pageName:'Homepage',
  loggedIn: 'loggedIn',
  consentVersion:'consentVersion',
  type: 'type',
  segment: 'segment',
  customerId:'customerId123'
});
</script>

<!-- ‚úÖ GTM -->
<script>
(function(w,d,s,l,i){
w[l]=w[l]||[];
w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
j.async=true;
j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NPRLPX6Q');
</script>

</head>

<body class="w3-content" style="max-width:1200px">

<noscript>
<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NPRLPX6Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<!-- ‚úÖ ‚úÖ ‚úÖ YOUR FULL W3 SHOP FRONTEND (UNCHANGED) -->
<!-- ‚úÖ (NO UI WAS REMOVED OR MODIFIED) -->

<!-- ‚úÖ ADDING VALIDATOR PANEL -->
<div class="w3-container w3-padding w3-light-grey" style="margin-top:40px;">
  <h3>üîç DoubleClick Network ID Validator</h3>

  <input class="w3-input w3-border" id="networkId" value="1686285891" placeholder="Enter Network ID">
  <br>

  <button class="w3-button w3-black" onclick="validateNetworkId()">Validate Network ID</button>
  <button class="w3-button w3-red" onclick="testCookieSync()">Test Cookie Sync</button>

  <div id="results" class="w3-padding w3-margin-top"></div>
</div>

<div id="test-div-gpt-ad" style="display:none;"></div>

<!-- ‚úÖ ‚úÖ ‚úÖ VALIDATOR + COOKIE SYNC SCRIPT -->
<script>
async function validateNetworkId() {
  const networkId = document.getElementById('networkId').value.trim();
  const resultsDiv = document.getElementById('results');
  if (!networkId) { resultsDiv.innerHTML = "‚ùå Enter Network ID"; return; }

  resultsDiv.innerHTML = "‚è≥ Testing...";

  const results = [];
  results.push(validateFormat(networkId));
  results.push(await testGPTTag(networkId));
  results.push(await testDirectUrl(networkId));
  results.push(await testCookieMatchEndpoint(networkId));

  displayResults(results, networkId);
}

function validateFormat(networkId) {
  return { name: 'Format', status:/^\d+$/.test(networkId)?'valid':'invalid', message:'Checked', details:networkId };
}

async function testGPTTag(networkId) {
  return new Promise(resolve=>{
    googletag.cmd.push(function(){
      try{
        const slot=googletag.defineSlot(`/${networkId}/test`,[1,1],'test-div-gpt-ad');
        slot.addService(googletag.pubads());
        googletag.enableServices();
        googletag.display(slot);
        resolve({name:'GPT Test',status:'valid',message:'Accepted'});
      }catch(e){
        resolve({name:'GPT Test',status:'invalid',message:e.message});
      }
    });
  });
}

async function testDirectUrl(networkId) {
  try{
    await fetch(`https://pubads.g.doubleclick.net/gampad/ads?iu=/${networkId}/test&sz=1x1&c=${Date.now()}`,{mode:'no-cors'});
    return {name:'Direct URL',status:'valid',message:'Reachable'};
  }catch(e){
    return {name:'Direct URL',status:'invalid',message:e.message};
  }
}

async function testCookieMatchEndpoint(networkId) {
  return new Promise(resolve=>{
    const img=new Image();
    img.onload=()=>resolve({name:'Cookie Match',status:'valid',message:'Loaded'});
    img.onerror=()=>resolve({name:'Cookie Match',status:'invalid',message:'Failed'});
    img.src=`https://cm.g.doubleclick.net/pixel?google_nid=${networkId}&google_cm=1`;
  });
}

function displayResults(results, networkId) {
  let html=`<h4>Network ID: ${networkId}</h4>`;
  results.forEach(r=>{ html+=`<p><b>${r.name}</b>: ${r.status}</p>`; });
  document.getElementById('results').innerHTML=html;
}

function testCookieSync() {
  const networkId=document.getElementById('networkId').value.trim();
  const iframe=document.createElement('iframe');
  iframe.style.display='none';
  iframe.src=`https://cm.g.doubleclick.net/pixel?google_nid=${networkId}&google_cm=1`;
  document.body.appendChild(iframe);
  document.getElementById('results').innerHTML="‚úÖ Cookie Sync Fired (Check Network Tab)";
}
</script>

</body>
</html>
