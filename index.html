<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
    <title>W3.CSS Template</title>
    <meta charset="UTF-8">
    <script type="text/javascript">
        function generateUserID() {
            try {
                let randomPart = crypto.randomUUID();
                var timestampPart = Math.floor(Date.now() / 1000).toString(16);
                return randomPart + '.' + timestampPart;
            } catch (error) {
                console.log("Error : ", error);
            }
        }
        function setPersistentCookie(name, value, days = 365) {
            try {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = "expires=" + date.toUTCString();
                const secure = window.location.protocol === 'https:' ? "Secure" : "";
                const sameSite = "SameSite=none";
                document.cookie = name + "=" + value + ";" + expires + ";path=/;" + secure + ";" + sameSite;
            } catch (error) {
                console.log("Error : ", error);
            }
        }
        function getCookie(name) {
            try {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [key, value] = cookie.split('=');
                    if (key.trim() === name.trim()) {
                        return decodeURIComponent(value);
                    }
                }
                return null;
            } catch (error) {
                console.log("Error : ", error);
            }
        }
        let userID = getCookie('userID');
        if (!userID) {
            userID = generateUserID();
            setPersistentCookie('userID', userID, 365);
        }

        const parentOrigins = [
            "https://retail-demo-web2-dot-acn-cda.uc.r.appspot.com",
            "https://developmentservice-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com",
            "https://testinnovation-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com",
            "https://staticwebsitedemo-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com",
            "https://reactdemosdk-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com",
            "https://angularwebsitedemo-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com"
        ];

        window.addEventListener('load', () => {
            let cookieValue = getCookie('userID');
            if (!cookieValue) {
                cookieValue = generateUserID();
                setPersistentCookie('userID', userID, 365);
            }

            if (cookieValue !== undefined) {
                parentOrigins.forEach(origin => {
                    try {
                        parent.postMessage({
                            type: 'thirdPartyCookieData',
                            cookieName: 'userID',
                            value: cookieValue
                        }, origin);
                    } catch (err) {
                        console.error(`[IFRAME] Error sending message to ${origin}:`, err);
                    }
                });

            } else {
                parentOrigins.forEach(origin => {
                    try {
                        parent.postMessage({
                            type: 'thirdPartyCookieNotFound',
                            cookieName: 'userID',
                        }, origin);
                    } catch (err) {
                        console.error(`[IFRAME] Error sending not-found message to ${origin}:`, err);
                    }
                });
            }
        });
        try {
            console.log('[IFRAME] Script execution finished setup.');
        } catch (e) {
            console.error('[IFRAME] Error during script setup or initial execution:', e);
        }
    </script>
</head>
<body>
</body>
</html>
